@using MedicalSite.Features.Learning.Models

<div class="max-w-2xl mx-auto">
    @if (Cards == null || !Cards.Any())
    {
        <div class="text-center py-12 text-slate-400 italic">
            No flashcards available for this topic.
        </div>
    }
    else
    {
        <!-- PROGRESS BAR -->
        <div class="mb-6 flex items-center justify-between text-sm font-medium text-slate-500 dark:text-slate-400">
            <span>Card @(currentIndex + 1) of @Cards.Count</span>
            <div class="w-32 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full bg-blue-500 transition-all duration-300" 
                     style="width: @(((currentIndex + 1) * 100) / Cards.Count)%">
                </div>
            </div>
        </div>

        <!-- CARD FLIP AREA -->
        <div class="perspective-1000 h-80 cursor-pointer group" @onclick="FlipCard">
            <div class="relative w-full h-full transition-transform duration-500 transform-style-3d @(isFlipped ? "rotate-y-180" : "")">
                
                <!-- FRONT (QUESTION) -->
                <!-- ALWAYS White Bg, Black Text -->
                <div class="absolute w-full h-full backface-hidden 
                            rounded-2xl shadow-xl flex flex-col items-center justify-center p-8 text-center border-2
                            bg-white border-slate-100 text-slate-900">
                    
                    <span class="absolute top-4 right-4 text-xs font-bold uppercase tracking-wider text-slate-400">
                        Question
                    </span>
                    
                    <h3 class="text-2xl font-bold leading-relaxed">
                        @CurrentCard.Front
                    </h3>

                    <!-- TAGS -->
                    @if (CurrentCard.Tags.Any())
                    {
                        <div class="absolute bottom-6 flex gap-2">
                            @foreach (var tag in CurrentCard.Tags)
                            {
                                <span class="px-2 py-1 text-xs font-semibold rounded-md 
                                             bg-slate-100 text-slate-600">
                                    #@tag
                                </span>
                            }
                        </div>
                    }
                </div>

                <!-- BACK (ANSWER) -->
                <!-- ALWAYS Blue-50 Bg, Black Text -->
                <div class="absolute w-full h-full backface-hidden rotate-y-180 
                            rounded-2xl shadow-xl flex flex-col items-center justify-center p-8 text-center border-2
                            bg-blue-50 border-blue-100 text-slate-900">
                    
                    <span class="absolute top-4 right-4 text-xs font-bold uppercase tracking-wider text-blue-400">
                        Answer
                    </span>
                    
                    <p class="text-xl font-medium leading-relaxed">
                        @CurrentCard.Back
                    </p>
                </div>
            </div>
        </div>

        <!-- CONTROLS -->
        <div class="mt-8 flex justify-center gap-4">
            <!-- Prev Button (Adaptive Background for button container) -->
            <button @onclick="PrevCard" disabled="@(currentIndex == 0)"
                    class="p-3 rounded-full border shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed
                           bg-white border-slate-200 text-slate-600 hover:bg-slate-50">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>

            <!-- Flip Button -->
            <button @onclick="FlipCard" 
                    class="px-8 py-3 rounded-full font-bold shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5
                           bg-blue-600 text-white hover:bg-blue-700">
                @(isFlipped ? "Show Question" : "Show Answer")
            </button>

            <!-- Next Button -->
            <button @onclick="NextCard" disabled="@(currentIndex == Cards.Count - 1)"
                    class="p-3 rounded-full border shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed
                           bg-white border-slate-200 text-slate-600 hover:bg-slate-50">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>
    }
</div>

<style>
    .perspective-1000 { perspective: 1000px; }
    .transform-style-3d { transform-style: preserve-3d; }
    .backface-hidden { backface-visibility: hidden; }
    .rotate-y-180 { transform: rotateY(180deg); }
</style>

@code {
    [Parameter] public List<Flashcard> Cards { get; set; } = new();

    private int currentIndex = 0;
    private bool isFlipped = false;
    private Flashcard CurrentCard => Cards[currentIndex];

    protected override void OnParametersSet()
    {
        currentIndex = 0;
        isFlipped = false;
    }

    private void FlipCard() => isFlipped = !isFlipped;

    private void NextCard()
    {
        if (currentIndex < Cards.Count - 1)
        {
            isFlipped = false;
            currentIndex++;
        }
    }

    private void PrevCard()
    {
        if (currentIndex > 0)
        {
            isFlipped = false;
            currentIndex--;
        }
    }
}